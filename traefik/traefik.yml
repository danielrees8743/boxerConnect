# Traefik v2 Static Configuration
# Main configuration for reverse proxy and SSL/TLS

# =============================================================================
# Global Configuration
# =============================================================================
global:
  checkNewVersion: true
  sendAnonymousUsage: false

# =============================================================================
# Entry Points (Ports)
# =============================================================================
entryPoints:
  # HTTP - Port 80 (redirects to HTTPS)
  web:
    address: ":80"
    http:
      redirections:
        entryPoint:
          to: websecure
          scheme: https
          permanent: true

  # HTTPS - Port 443
  websecure:
    address: ":443"
    http:
      tls:
        certResolver: letsencrypt
        # Domain configuration handled via Docker labels
        # Remove wildcard - HTTP challenge cannot validate wildcards

# =============================================================================
# Certificate Resolvers (Let's Encrypt)
# =============================================================================
certificatesResolvers:
  letsencrypt:
    acme:
      email: "admin@example.com"  # IMPORTANT: Replace with your actual email before deployment
      storage: /certificates/acme.json
      # Use staging server for testing to avoid rate limits (comment out for production)
      # caServer: https://acme-staging-v02.api.letsencrypt.org/directory

      # HTTP Challenge (works for non-wildcard certificates)
      httpChallenge:
        entryPoint: web

      # DNS Challenge (required for wildcard certificates - configure DNS provider)
      # dnsChallenge:
      #   provider: cloudflare  # or your DNS provider
      #   delayBeforeCheck: 30

# =============================================================================
# API and Dashboard
# =============================================================================
api:
  dashboard: true
  insecure: false  # Disable insecure access

# =============================================================================
# Providers
# =============================================================================
providers:
  # Docker provider
  docker:
    endpoint: "unix:///var/run/docker.sock"
    exposedByDefault: false  # Only expose containers with traefik.enable=true
    network: boxerconnect-frontend
    watch: true

  # File provider for additional dynamic configuration
  file:
    filename: /config.yml
    watch: true

# =============================================================================
# Logging
# =============================================================================
log:
  level: INFO  # DEBUG, INFO, WARN, ERROR
  format: common  # common or json

# Access logs
accessLog:
  format: common
  bufferingSize: 100

# =============================================================================
# Security Headers (Global)
# =============================================================================
# Applied via middleware in config.yml
